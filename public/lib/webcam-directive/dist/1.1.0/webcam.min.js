"use strict";!function(){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.hasUserMedia=function(){return navigator.getMedia?!0:!1}}(),angular.module("webcam",[]).directive("webcam",function(){return{template:'<div class="webcam" ng-transclude></div>',restrict:"E",replace:!0,transclude:!0,scope:{onError:"&",onStream:"&",onStreaming:"&",placeholder:"="},link:function(a,b){var c,d;a.$on("$destroy",function(){d&&"function"==typeof d.stop&&d.stop(),c&&delete c.src});var e=function(b){if(d=b,navigator.mozGetUserMedia)c.mozSrcObject=b;else{var e=window.URL||window.webkitURL;c.src=e.createObjectURL(b)}c.play(),a.onStream&&a.onStream({stream:b,video:c})},f=function(b){h(),console&&console.log&&console.log("The following error occured: ",b),a.onError&&a.onError({err:b})};if(c=document.createElement("video"),c.setAttribute("class","webcam-live"),c.setAttribute("autoplay",""),b.append(c),a.placeholder){var g=document.createElement("img");g.setAttribute("class","webcam-loader"),g.src=a.placeholder,b.append(g)}var h=function(){g&&angular.element(g).remove()},i=!1,j=b.width=320,k=b.height=0;if(!window.hasUserMedia())return void f({code:-1,msg:"Browser does not support getUserMedia."});var l={video:!0,audio:!1};navigator.getMedia(l,e,f),c.addEventListener("canplay",function(){if(!i){var b=j/c.videoWidth;k=c.videoHeight*b||250,c.setAttribute("width",j),c.setAttribute("height",k),i=!0,h(),a.onStreaming&&a.onStreaming({video:c})}},!1)}}});